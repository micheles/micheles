<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.3.4: http://docutils.sourceforge.net/" />
<title></title>
<link rel="stylesheet" href="default.css" type="text/css" />
</head>
<body>
<div class="document">
<div class="section" id="automatic-testing-in-python-wonderful-doctest">
<h1><a name="automatic-testing-in-python-wonderful-doctest">Automatic testing in Python: wonderful doctest!</a></h1>
<p>&lt;center&gt;</p>
<blockquote>
<p>Italian Code Jam &lt;br/&gt;</p>
<blockquote>
09 Oct 2004 &lt;br/&gt;</blockquote>
<p>Michele Simionato &lt;br/&gt;</p>
<blockquote>
Partecs s.r.l. &lt;br/&gt;</blockquote>
</blockquote>
<p>&lt;/center&gt;</p>
<div class="section" id="summary">
<h2><a name="summary">Summary</a></h2>
<dl>
<dt>&lt;ul&gt;</dt>
<dd>&lt;li&gt; What is automatic testing? &lt;/li&gt;
&lt;li&gt; Why automatic testing is better? &lt;/li&gt;
&lt;li&gt; Which kind of automatic testing should I do? &lt;/li&gt;
&lt;li&gt; Why I did start writing automatic tests? &lt;/li&gt;
&lt;li&gt; A few real life examples &lt;/li&gt;</dd>
</dl>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt>talk.txt</tt>, line 26)</p>
Definition list ends without a blank line; unexpected unindent.</div>
<p>&lt;ul&gt;</p>
</div>
<div class="section" id="what-is-automatic-testing">
<h2><a name="what-is-automatic-testing">What is automatic testing</a></h2>
<p>Any methodology that allows you to test
your application mechanically, repeatedly
and in a controlled reproducible way.</p>
</div>
<div class="section" id="why-automatic-testing-is-better">
<h2><a name="why-automatic-testing-is-better">Why automatic testing is better</a></h2>
<p>Try to perform <em>manual</em> testing and you will have the answer!</p>
</div>
<div class="section" id="automatic-testing-in-python">
<h2><a name="automatic-testing-in-python">Automatic testing in Python ...</a></h2>
<p>There are two standard testing frameworks in Python:</p>
<dl>
<dt>&lt;ol&gt;</dt>
<dd>&lt;li&gt; unittest &lt;/li&gt;
&lt;li&gt; doctest &lt;/li&gt;</dd>
</dl>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt>talk.txt</tt>, line 51)</p>
Definition list ends without a blank line; unexpected unindent.</div>
<p>&lt;/ol&gt;</p>
<p>Which one should I use?</p>
</div>
<div class="section" id="the-short-answer">
<h2><a name="the-short-answer">The short answer</a></h2>
<p>unitest is boring, doctest is cool, so let's
talk about it!</p>
<blockquote>
;-)</blockquote>
</div>
<div class="section" id="more-seriously">
<h2><a name="more-seriously">More seriously</a></h2>
<p>Use different testing frameworks; each one has advantages
and disadvantages; use combinations of them; invert your
own testing procedure.</p>
<p>I use combinations of</p>
<dl>
<dt>&lt;ul&gt;</dt>
<dd>&lt;li&gt; unittest &lt;/li&gt;
&lt;li&gt; doctest &lt;/li&gt;
&lt;li&gt; custom tests &lt;/li&gt;
&lt;li&gt; Makefile driven tests &lt;/li&gt;
&lt;li&gt; poor man assertions &lt;/li&gt;
&lt;li&gt; et al. &lt;/li&gt;</dd>
</dl>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt>talk.txt</tt>, line 81)</p>
Definition list ends without a blank line; unexpected unindent.</div>
<p>&lt;/ul&gt;</p>
</div>
<div class="section" id="what-is-doctest">
<h2><a name="what-is-doctest">What is doctest?</a></h2>
<p>In its simplest form (not the form I use it ;) it allows
you to include tests in the docstrings of your application.</p>
</div>
<div class="section" id="example">
<h2><a name="example">Example</a></h2>
<p># split.py
import re</p>
<dl>
<dt>def split(text, sep = re.compile(r&quot;s*[,;]s*&quot;)):</dt>
<dd>&quot;&quot;&quot;Split a string taking as separators &quot;,&quot; &quot;;&quot;.
Example:
&gt;&gt;&gt; from split import split
&gt;&gt;&gt; split(&quot;hello, world!; welcome to the Italian Code Jam!&quot;)
['hello', 'world!', 'welcome to the Italian Code Jam!']
&quot;&quot;&quot;
return sep.split(text)</dd>
<dt>if __name__ == &quot;__main__&quot;:</dt>
<dd>import __main__, doctest
doctest.testmod(__main__)</dd>
</dl>
</div>
<div class="section" id="running-doctest-in-verbose-mode">
<h2><a name="running-doctest-in-verbose-mode">Running doctest in verbose mode</a></h2>
<p>&lt;pre&gt;
$ python split.py -v
Running __main__.__doc__
0 of 0 examples failed in __main__.__doc__
Running __main__.split.__doc__
Trying: from split import split
Expecting: nothing
ok
Trying: split(&quot;hello, world!; welcome to the Italian Code Jam!&quot;)
Expecting: ['hello', 'world!', 'welcome to the Italian Code Jam!']
ok
0 of 2 examples failed in __main__.split.__doc__
1 items had no tests:</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt>talk.txt</tt>, line 113)</p>
Unexpected indentation.</div>
<blockquote>
__main__</blockquote>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt>talk.txt</tt>, line 131)</p>
Block quote ends without a blank line; unexpected unindent.</div>
<dl>
<dt>1 items passed all tests:</dt>
<dd>2 tests in __main__.split</dd>
</dl>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt>talk.txt</tt>, line 133)</p>
Definition list ends without a blank line; unexpected unindent.</div>
<p>2 tests in 2 items.
2 passed and 0 failed.
Test passed.
&lt;/pre&gt;</p>
</div>
<div class="section" id="why-i-do-not-use-the-standard-approach">
<h2><a name="why-i-do-not-use-the-standard-approach">Why I do not use the standard approach</a></h2>
<p>&lt;ul&gt;
&lt;li&gt; It makes you end up with very large docstrings where the actual
code is easily lost &lt;/li&gt;</p>
<p>&lt;li&gt; It abuses the original purpose of docstrings&lt;/li&gt;</p>
<p>&lt;li&gt; It conflates two different aspects (code and tests on the code)&lt;/li&gt;</p>
<dl>
<dt>&lt;li&gt; It is much easier to write the documentation in a separate</dt>
<dd>text file &lt;/li&gt;</dd>
</dl>
<p>&lt;li&gt; Testing should be done by an external tool anyway &lt;/li&gt;
&lt;/ul&gt;</p>
</div>
<div class="section" id="how-i-use-doctest">
<h2><a name="how-i-use-doctest">How I use doctest</a></h2>
<dl>
<dt>&lt;ul&gt;</dt>
<dd><p class="first">&lt;li&gt;I find that too long docstrings make reading the code difficult&lt;/li&gt;</p>
<p>&lt;li&gt; I like keeping the documentation on a separate rst file&lt;/li&gt;</p>
<p>&lt;li&gt;there is no sync problem since you run the tests all the time&lt;/li&gt;</p>
<dl>
<dt>&lt;li&gt; so I wrote a custom utility to extract doctests from the&lt;/li&gt;</dt>
<dd>documentation file</dd>
</dl>
<p>&lt;li&gt;useful for writing articles ...&lt;/li&gt;</p>
<p class="last">&lt;li&gt; ... but also tutorials for internal usage in the company&lt;/li&gt;</p>
</dd>
</dl>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt>talk.txt</tt>, line 173)</p>
Definition list ends without a blank line; unexpected unindent.</div>
<p>&lt;/ul&gt;</p>
</div>
<div class="section" id="the-split-example-revisited">
<h2><a name="the-split-example-revisited">The split example revisited</a></h2>
<p>&lt;pre&gt;</p>
</div>
</div>
<div class="section" id="documentation-for-the-split-module">
<h1><a name="documentation-for-the-split-module">Documentation for the 'split' module</a></h1>
<p>The module contains a 'split' function, which 
splits a string taking as separators &quot;,&quot; and &quot;;&quot;.
This is an example of usage:</p>
<pre class="doctest-block">
&gt;&gt;&gt; from split import split
&gt;&gt;&gt; split(&quot;hello, world!; welcome to the Italian Code Jam!&quot;)
['hello', 'world!', 'welcome to the Italian Code Jam!']
</pre>
<p>&lt;/pre&gt;</p>
<div class="section" id="the-split-example-revisited-continued">
<h2><a name="the-split-example-revisited-continued">The split example revisited (continued)</a></h2>
<p>&lt;pre&gt;</p>
<p>Notice that 'split' eats whitespaces:</p>
<pre class="doctest-block">
&gt;&gt;&gt; split(&quot;hello ,  world&quot;)
['hello', 'world']
</pre>
<pre class="doctest-block">
&gt;&gt;&gt; split(&quot;hello , ;  world&quot;)
['hello', '', 'world']
</pre>
<p>&lt;/pre&gt;</p>
</div>
<div class="section" id="when-tests-fail">
<h2><a name="when-tests-fail">When tests fail</a></h2>
<p>&lt;pre&gt;</p>
<p>$ cat split-failure.txt
An example of failed text:</p>
<pre class="doctest-block">
&gt;&gt;&gt; from split import split
&gt;&gt;&gt; split(&quot;hello, world&quot;)
['hello', ' world']
</pre>
<div class="section" id="doct-split-failure-txt">
<h3><a name="doct-split-failure-txt">$ doct split-failure.txt</a></h3>
<p>Failure in example: split(&quot;hello, world&quot;)
from line #5 of split-failure.txt
Expected: ['hello', ' world']
Got: ['hello', 'world']</p>
<p>&lt;/pre&gt;</p>
<p>Unfortunately doctest does not stop at the first failed test.</p>
</div>
</div>
<div class="section" id="managing-exceptions">
<h2><a name="managing-exceptions">Managing exceptions</a></h2>
<p>It is possible to test that your program raises the exception you
expect:</p>
<p>&lt;pre&gt;</p>
<p>$ echo &quot;&quot;&quot; # split cannot work on a list
&gt;&gt;&gt; from split import split
&gt;&gt;&gt; split([])
Traceback (most recent call last):</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt>talk.txt</tt>, line 230)</p>
Unexpected indentation.</div>
<blockquote>
...</blockquote>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt>talk.txt</tt>, line 248)</p>
Block quote ends without a blank line; unexpected unindent.</div>
<p>TypeError: expected string or buffer</p>
<p>&quot;&quot;&quot; &gt; x.txt</p>
<p>$ doct x.txt
x.txt: 2 tests passed in 0.01 seconds</p>
<p>&lt;/pre&gt;</p>
<p>(notice however that relying on exception messags may be risky)
(IGNORE_EXCEPTION_DETAIL)</p>
</div>
<div class="section" id="converting-doctests-to-unittests">
<h2><a name="converting-doctests-to-unittests">Converting doctests to unittests</a></h2>
<blockquote>
<p>import unittest
import doctest
import my_module_with_doctests</p>
<p>suite = doctest.DocTestSuite(my_module_with_doctests)
runner = unittest.TextTestRunner()
runner.run(suite)</p>
</blockquote>
</div>
<div class="section" id="doctest-caveats">
<h2><a name="doctest-caveats">Doctest caveats</a></h2>
<p>&lt;ul&gt;</p>
<p>&lt;li&gt; Expected output must end with a newline &lt;/li&gt;
&lt;li&gt; Expected output cannot contain a blank line &lt;/li&gt;
&lt;li&gt; Output to stdout is captured, but not output to stderr&lt;/li&gt;</p>
<p>&lt;/ul&gt;</p>
</div>
<div class="section" id="why-doctest-is-cool">
<h2><a name="why-doctest-is-cool">Why doctest is cool</a></h2>
<dl>
<dt>&lt;ul&gt;</dt>
<dd><p class="first">&lt;li&gt; it makes you improve the quality of your documentation &lt;/li&gt;</p>
<p>&lt;li&gt; it is easy to understand and to explain &lt;/li&gt;</p>
<p>&lt;li&gt; it can be converted to unittest anyway &lt;/li&gt;</p>
<p class="last">&lt;li&gt; it does not allow inheritance ;-) &lt;/li&gt;</p>
</dd>
</dl>
<p>&lt;/ul&gt;</p>
</div>
<div class="section" id="doctest-is-becoming-even-cooler">
<h2><a name="doctest-is-becoming-even-cooler">doctest is becoming even cooler</a></h2>
<p>With Python 2.4 you can automatically convert
doctests in external text files into unittests:</p>
<p>&lt;pre&gt;</p>
<blockquote>
import doctest, unittest
suite = doctest.DocFileSuite(my_documentation_file, package=mypackage)
unittest.TextTestRunner().run(suite)</blockquote>
<p>&lt;/pre&gt;</p>
</div>
<div class="section" id="python-2-4-recognizes-blank-lines">
<h2><a name="python-2-4-recognizes-blank-lines">Python 2.4 recognizes blank lines</a></h2>
<p>Blank lines can be marked with &amp;lt;BLANKLINE&amp;gt;  :
&lt;pre&gt;
&gt;&gt;&gt; print 'foonnbarn'
foo
&amp;lt;BLANKLINE&amp;gt;
bar
&amp;lt;BLANKLINE&amp;gt;</p>
<p>&lt;/pre&gt;</p>
</div>
<div class="section" id="python-2-4-recognizes-flags">
<h2><a name="python-2-4-recognizes-flags">Python 2.4 recognizes flags!</a></h2>
<p>&lt;ul&gt;
&lt;li&gt;                If the ellipsis flag is used, then '...' can be used to</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt>talk.txt</tt>, line 316)</p>
Unexpected indentation.</div>
<blockquote>
elide substrings in the desired output: &lt;pre&gt;</blockquote>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt>talk.txt</tt>, line 334)</p>
Block quote ends without a blank line; unexpected unindent.</div>
<pre class="doctest-block">
&gt;&gt;&gt; print range(1000) #doctest: +ELLIPSIS
[0, 1, 2, ..., 999]
</pre>
<p>&lt;/pre&gt;&lt;/li&gt;</p>
<dl>
<dt>&lt;li&gt;  </dt>
<dd>If the whitespace normalization flag is used, then
differences in whitespace are ignored.&lt;pre&gt;</dd>
</dl>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt>talk.txt</tt>, line 342)</p>
Definition list ends without a blank line; unexpected unindent.</div>
<pre class="doctest-block">
&gt;&gt;&gt; print range(20) #doctest: +NORMALIZE_WHITESPACE
[0,  1,  2, 3,         4,  5, 6, 7, 8, 9, 10, 11, 
12, 13, 14,  15, 16,  17, 18,  19]
</pre>
<p>&lt;/pre&gt;&lt;/li&gt;</p>
<p>&lt;/ul&gt;</p>
</div>
<div class="section" id="conclusion-good-reasons-to-use-doctest">
<h2><a name="conclusion-good-reasons-to-use-doctest">Conclusion: good reasons to use doctest</a></h2>
<p>&lt;ol&gt;</p>
<p>&lt;li&gt; it is cool &lt;/li&gt;
&lt;/ol&gt;</p>
</div>
<div class="section" id="references">
<h2><a name="references">References</a></h2>
<p>&lt;ul&gt;</p>
<p>&lt;li&gt;The standard library documentation
<a class="reference" href="http://docs.python.org/lib/module-doctest.html">http://docs.python.org/lib/module-doctest.html</a> &lt;/li&gt;</p>
<p>&lt;li&gt; The doctest talk by Tim Peters and Jim Fulton 
<a class="reference" href="http://www.python.org/pycon/dc2004/papers/4">http://www.python.org/pycon/dc2004/papers/4</a>/&lt;/li&gt;</p>
<p>&lt;li&gt; doctest.py &lt;/li&gt; 
&lt;/ul&gt;</p>
</div>
</div>
</div>
</body>
</html>
